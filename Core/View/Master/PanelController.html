{% extends "Master/MenuTemplate.html" %}

{% block css %}
    {{ parent() }}
    
    <style type="text/css">
        .card-header {
            padding: .5rem 1.25rem;
            font-size: 120%;
            font-weight: bold;
        }
        
        .cust-text {
            margin-left: 35px;
            overflow: hidden;
            font-size: 80%;
        }

        legend {
            font-size: 120%;
            font-weight: bold;
        }

        label {
            font-weight: 500;
        }

        select[required],
        input[required] {
            background: aliceblue;
        }
        
        input:invalid,
        input:required:invalid {
            border: 1px solid red;
        }
    </style>
{% endblock %}

{% block javascript %}
    {{ parent() }}
<script type="text/javascript">
    var tabActive = '{{ fsc.active }}';
    $(document).ready(function () {
        $('#mainTabs').on('shown.bs.tab', function (e) {
            tabActive = e.target.hash.substring(1);
        });
    });
</script>
{% endblock %}

{% block messages %}
<div class="container-fluid">
    <div id="messages" class="row">
        <div class="col-12">
            {{ parent() }}
        </div>
    </div>
</div>
{% endblock %}

{% block body %}
{# -- Calculate texts according to language -- #}
{% set go_back = i18n.trans('back') %}
{% set refresh_title = i18n.trans('refresh') %}

{% set title = fsc.getPageData()['title'] %}
{% set title = i18n.trans(title) %}

{# -- Calculate common values -- #}
{% set list_url = fsc.getURL('list') %}
{% set edit_url = fsc.getURL('edit') %}

{# -- Visual macros -- #}
{% from 'Macro/Utils.html' import popoverTitle as popoverTitle %}
{% from 'Macro/Utils.html' import exportData as exportData %}
{% from 'Macro/BaseController.html' import columnsForListView as columnsForListView %}
{% from 'Macro/BaseController.html' import columnsForEditListView as columnsForEditListView %}
{% from 'Macro/BaseController.html' import columnsForEditView as columnsForEditView %}

{# -- Main Body -- #}
<div class="container-fluid">
    {{ parent() }}
    
    {# -- Header Row -- #}
    <div id="header" class="row">
        <div class="col-3 d-print-none">
            <div class="btn-group" aria-label="Button group with navigation actions">
                <a href="{{ list_url }}" class="btn btn-sm btn-light">
                    <i class="fa fa-arrow-left" aria-hidden="true"></i>
                    <span class="hidden-xs hidden-sm">&nbsp;{{ go_back }} </span>
                </a>
                <a href="{{ edit_url }}" class="btn btn-sm btn-light" {{ popoverTitle(refresh_title, 'bottom') }}>
                    <i class="fa fa-refresh" aria-hidden="true"></i>
                </a>
            </div>
            
            {# -- Añadimos opciones de impresión y exportación -- #}
            {{ exportData(fsc, i18n, 'edit') }}
        </div>

        <div class="col-6 text-center">
            <div class="page-header">
                <h2>
                    <i class="fa {{ fsc.getPageData()['icon'] }}" aria-hidden="true"></i> {{ title }}
                </h2>
            </div>
        </div>
    </div>

    <p>&nbsp;</p>

    {# -- Data Row -- #}
    <div id="data" class="row">
        {# -- Left Panel -- #}
        <div class="col-sm-auto ml-3 mb-2">
            <div class="nav flex-column nav-pills" id="optionsindex" role="tablist">
            {% for indexView, view in fsc.views %}
                {% set active = (indexView == fsc.active) ? ' active' : '' %}                    
                <a class="nav-link{{ active }}" id="{{ indexView }}-tab" data-toggle="pill" href="#{{ indexView }}" role="tab" aria-controls="{{ indexView }}" aria-expanded="true">
                    <i class="fa {{ fsc.icons[indexView] }}" aria-hidden="true"></i>
                    &nbsp;{{ view.title }}
                </a>
            {% endfor %}                        
            </div>
        </div>
        
        {# -- Right Panel -- #}
        <div class="col mr-3">
            <div class="card">
                <div class="card-body">
                    <div class="tab-content" id="optionsindex-tabContent">                        
                    {% for indexView, view in fsc.views %}
                        {% set active = (indexView == fsc.active) ? ' show active' : '' %}                    
                        <div class="tab-pane fade{{ active }}" id="{{ indexView }}" role="tabpanel" aria-labelledby="{{ indexView }}-tab">                                                        
                            {% set viewType = fsc.viewClass(view) %}
                            {% if viewType == 'ListView' %}
                                {{ columnsForListView(_context, view) }}
                            {% endif %}
                            
                            {% if viewType == 'EditView' %}
                                {% set model = view.getModel() %}
                                {{ columnsForEditView(_context, view, model, TRUE) }}
                            {% endif %}                            

                            {% if viewType == 'EditListView' %}
                                {{ columnsForEditListView(_context, view) }}
                            {% endif %}
                            
                            {% if viewType == 'HtmlView' %}
                            <div class="row">
                            {% include view.fileName ignore missing %}
                            </div>
                            {% endif %}                            
                        </div>
                    {% endfor %}                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>    
{% endblock %}
